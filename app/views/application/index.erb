<h1>Balance Metrics</h1>

<h3>By source:</h3>
<table>
  <tr>
    <th>Source</th>
    <th>Successful checks</th>
    <th>Uniques</th>
    <th>Engagement rate</th>
  </tr>
  <% @metrics_by_source.sort_by { |name, metrics| -metrics['uniques']}.each do |name, metrics| %>
    <tr>
      <td><%= "#{name}" %></td>
      <td><%= "#{metrics['checks']}" %></td>
      <td><%= "#{metrics['uniques']}" %></td>
      <td><%= "#{metrics['engagement'].round(2)}" %></td>
    </tr>
  <% end %>
</table>

<h3># of successful balance checks: <%= @count_of_successful_messages %><h3>
<h3>By week:</h3>
<ul>
<% @successful_messages_by_week.each_pair do |k,v| %>
  <li><%= "#{k.strftime("%b %d")}: #{v}" %></li>
<% end %>
</ul>

<h3># of unique users with at least 1 successful balance check: <%= @number_of_unique_phone_numbers_with_one_successful_balance_check %></h3>

<h3>Traffic sources (# of successful checks per source):</h3>
<ul>
<% @successful_messages_by_source.each do |a| %>
  <li><%= "#{a[0]}: #{a[1]}" %></li>
<% end %>
</ul>

<h3># of errors (ie, ""I'm sorry! We're having trouble...): <%= @count_of_error_messages %><h3>
<h3>By week:</h3>
<ul>
<% @error_messages_by_week.each_pair do |k,v| %>
  <li><%= "#{k.strftime("%b %d")}: #{v}" %></li>
<% end %>
</ul>

<h3>CHARTS!!<h3>
<iframe width="800" height="600" frameborder="0" seamless="seamless" scrolling="no" src="<%= "#{@successful_messages_plot_url}" %>.embed?width=800&height=600"></iframe>
<br>
<br>
<iframe width="800" height="600" frameborder="0" seamless="seamless" scrolling="no" src="<%= "#{@uniques_plot_url}" %>.embed?width=800&height=600"></iframe>
